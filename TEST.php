<?php
    require_once __DIR__ . '/config/databaseConn.php';
    ini_set('display_errors', 1);
    ini_set('display_startup_errors', 1);
    error_reporting(E_ALL);    
function createNews($title, $content, $author_id, $images = []) {
    $conn = getConnection();
    $sql = "INSERT INTO news (title, content, author_id, images)
            VALUES (?, ?, ?, ?)";

    $stmt = $conn->prepare($sql);
    if (!$stmt) {
        return ['success' => false, 'error' => $conn->error];
    }

    $contentJson = json_encode($content, JSON_UNESCAPED_UNICODE);
    $imagesJson = json_encode($images, JSON_UNESCAPED_UNICODE);

    $stmt->bind_param('ssis', $title, $contentJson, $author_id, $imagesJson);
    
    if ($stmt->execute()) {
        $insertedId = $stmt->insert_id;
        $stmt->close();
        return ['success' => true, 'id' => $insertedId];
    } else {
        $error = $stmt->error;
        $stmt->close();
        return ['success' => false, 'error' => $error];
    }

}

    $title = 'COCK' ?? '';
    $author = '3' ?? '';
    $content = [
    "https://picsum.photos/id/1011/800/600",
    "https://picsum.photos/id/1012/800/600",
    "https://picsum.photos/id/1013/800/600"] ?? '';

    $contentArray = [
    "<p>Сегодня в южной части области состоялось торжественное открытие нового сельскохозяйственного рынка. Это событие собрало десятки местных жителей и фермеров, а также представителей региональной администрации. Новый рынок был построен в рекордные сроки — всего за 4 месяца, что стало возможным благодаря слаженной работе подрядчиков и активной поддержке со стороны местных властей.</p>",
    "<p>На церемонии присутствовали местные фермеры, представители администрации и покупатели. В своей приветственной речи глава района подчеркнул важность поддержки сельхозпроизводителей и выразил надежду, что рынок станет точкой роста для всей южной агрозоны.</p>",
    "<h2>Особенности нового рынка</h2>",
    "<ul>",
    "<li>Площадь более 2000 кв. метров;</li>",
    "<li>50 крытых торговых павильонов с холодильным оборудованием;</li>",
    "<li>Отдельные зоны для продукции растительного и животного происхождения;</li>",
    "<li>Парковка на 100 автомобилей;</li>",
    "<li>Система утилизации отходов и контроль качества продукции.</li>",
    "</ul>",
    "<p>Кроме того, на территории комплекса работает информационный киоск, где можно получить сведения о сертификации товаров, контактные данные фермеров, а также узнать о сезонных ярмарках и мероприятиях.</p>",
    "<h2>Цитаты участников</h2>",
    "<blockquote class=\"blockquote\">",
    "<p class=\"mb-0\">«Мы долго ждали такой площадки. Наконец-то у нас будет постоянное место с отличной инфраструктурой для сбыта своей продукции», — поделилась фермерка Наталья Ивановна из села Зеленая Долина.</p>",
    "</blockquote>",
    "<blockquote class=\"blockquote\">",
    "<p class=\"mb-0\">«Открытие рынка — это ещё один шаг к продовольственной безопасности региона. Мы поддержим и развиваем малый агробизнес», — заявил заместитель главы администрации области.</p>",
    "</blockquote>",
    "<h2>Ожидания и перспективы</h2>",
    "<p>Ожидается, что новый рынок поможет стимулировать местную экономику, создавая рабочие места и улучшая логистику для фермеров. Уже в первые часы работы было продано более 2 тонн свежих овощей, мяса и молочной продукции.</p>",
    "<p>В ближайшие месяцы планируется запуск программы лояльности для постоянных покупателей, а также проведение обучающих семинаров для фермеров по маркетингу, переработке продукции и цифровым технологиям в агросекторе.</p>",
    "<hr>",
    "<p class=\"text-muted\"><small>Материал подготовлен при поддержке местного аграрного совета. Все фото и видеоматериалы предоставлены пресс-службой администрации района.</small></p>"
]; 

$title = 'COCK';
$author_id = 3;
$content = $contentArray; // HTML-контент
$images = [
    "https://picsum.photos/id/1011/800/600",
    "https://picsum.photos/id/1012/800/600",
    "https://picsum.photos/id/1013/800/600"
];

$result = createNews($title, $content, $author_id, $images);

if ($result['success']) {
    echo 'News created with ID: ' . $result['id'];
} else {
    echo 'Error: ' . $result['error'];
}


$_

?>